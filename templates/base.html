<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Leave Tracker{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  >

  <!-- Main styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

  <!-- Top navigation -->
  <nav class="app-nav">
    <div class="nav-inner d-flex justify-content-between align-items-center">

      <!-- Left side: logo only -->
      <div class="d-flex align-items-center">
        <a href="{{ url_for('index') if g.user else url_for('login') }}"
           class="kmp-nav-logo-link">
          <img src="{{ url_for('static', filename='kmp_logo.png') }}"
               alt="Keepmeposted"
               class="kmp-logo me-2">
        </a>
      </div>

      <!-- Right side: user dropdown / auth -->
      <div class="app-nav-right d-flex align-items-center gap-2">
        {% if g.user %}

          {% if g.user.employee %}
            {% set display_name = g.user.employee.name %}
          {% else %}
            {% set display_name = g.user.username %}
          {% endif %}

          <div class="dropdown">
            <button class="btn btn-outline-secondary btn-sm dropdown-toggle app-user-menu-btn"
                    type="button"
                    id="userMenuDropdown"
                    data-bs-toggle="dropdown"
                    aria-expanded="false">
              {{ display_name }}
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuDropdown">

              {% if g.is_admin %}
                <li>
                  <a class="dropdown-item"
                     href="{{ url_for('list_leave_requests') }}">
                    Leave requests
                  </a>
                </li>
                <li>
                  <a class="dropdown-item"
                     href="{{ url_for('manage_users') }}">
                    Manage users
                  </a>
                </li>
                <li>
                  <a class="dropdown-item"
                     href="{{ url_for('manage_employees') }}">
                    Manage employees
                  </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item text-danger"
                     href="{{ url_for('logout') }}">
                    Logout
                  </a>
                </li>

              {% elif g.is_manager %}
                <li>
                  <a class="dropdown-item"
                     href="{{ url_for('list_leave_requests') }}">
                    Leave requests
                  </a>
                </li>
                <li>
                  <a class="dropdown-item"
                     href="{{ url_for('request_leave') }}">
                    Request leave
                  </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item text-danger"
                     href="{{ url_for('logout') }}">
                    Logout
                  </a>
                </li>

              {% else %}
                {# Employee: only Logout in the dropdown #}
                <li>
                  <a class="dropdown-item text-danger"
                     href="{{ url_for('logout') }}">
                    Logout
                  </a>
                </li>
              {% endif %}
            </ul>
          </div>

        {% else %}
          {# Logged-out state #}
          <a href="{{ url_for('login') }}"
             class="btn btn-outline-primary btn-sm">
            Login
          </a>
        {% endif %}
      </div>
    </div>
  </nav>

  <!-- Main content wrapper -->
  <div class="app-wrapper container">
    {% block content %}
      {% if content is defined %}
        {{ content|safe }}
      {% endif %}
    {% endblock %}
  </div>

  <!-- Footer -->
  <footer class="lt-footer mt-auto">
    <div class="container d-flex justify-content-between align-items-center">
      <div class="text-muted small">
        All rights reserved.
      </div>
      <div class="text-muted small">
        <a href="https://schaak.mt"
           target="_blank"
           class="lt-footer-link">
          Developed by Schaak.mt
        </a>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS bundle -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>

  {% block scripts %}{% endblock %}
</body>
</html>
