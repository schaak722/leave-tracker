{% extends "base.html" %}

{% block content %}
<h2 class="mb-3">Edit Employee</h2>

{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% endif %}

<div class="card mb-3">
  <div class="card-body">
    <form method="post">
      <!-- Employee details -->
      <h5 class="mb-2">Employee details</h5>

      <div class="mb-3">
        <label class="form-label">Name</label>
        <input type="text"
               name="name"
               class="form-control"
               value="{{ employee.name }}">
      </div>

      <div class="mb-3">
        <label class="form-label">Birthday</label>
        <input type="date"
               name="birthday"
               class="form-control"
               value="{{ employee.birthday.strftime('%Y-%m-%d') if employee.birthday }}">
      </div>

      <div class="form-check mb-4">
        <input class="form-check-input"
               type="checkbox"
               name="active"
               id="activeCheck"
               {% if employee.active %}checked{% endif %}>
        <label class="form-check-label" for="activeCheck">
          Active (show in calendars)
        </label>
      </div>

      <!-- Leave days editor -->
      <h5 class="mb-2">Leave days</h5>
      <p class="text-muted mb-2" style="font-size: 0.8rem;">
        Set or update leave days for a specific year. If the year already exists, its leave days will be updated;
        otherwise a new record will be created.
      </p>

      <div class="row g-3 align-items-end mb-3">
        <div class="col-auto">
          <label class="form-label">Year</label>
          <input type="number"
                 name="ent_year"
                 class="form-control"
                 value="{{ current_year }}">
        </div>
        <div class="col-auto">
          <label class="form-label">Leave days</label>
          <input type="number"
                 step="0.5"
                 name="ent_days"
                 class="form-control"
                 value="{{ current_year_ent_days }}">
        </div>
      </div>

      <button type="submit" class="btn btn-primary">Save</button>
      <a href="{{ url_for('manage_employees') }}" class="btn btn-secondary ms-2">Cancel</a>
    </form>
  </div>
</div>

<h5>All leave days</h5>
<div class="card">
  <div class="card-body">
    {% if employee.entitlements %}
  <ul class="mb-2">
  {% for ent in employee.entitlements|sort(attribute="year") %}
    <li>
      {{ ent.year }}: {{ "%.1f"|format(ent.days) }} days
      <form method="post"
            action="{{ url_for('delete_entitlement', employee_id=employee.id, year=ent.year) }}"
            class="d-inline"
            onsubmit="return confirm('Remove leave days for {{ ent.year }} for {{ employee.name }}?');">
        <button type="submit"
                class="btn btn-link btn-sm text-danger p-0 ms-2">
          Remove
        </button>
      </form>
    </li>
  {% endfor %}
  </ul>
{% else %}
  <p class="mb-2">No leave days defined.</p>
{% endif %}

    <p class="text-muted mb-0" style="font-size: 0.8rem;">
      Use the fields above to change or add leave days for any year.
    </p>
  </div>
</div>

<a href="{{ url_for('manage_employees') }}" class="btn btn-outline-primary btn-sm mt-3">
  Back to employees
</a>
{% endblock %}
